import{K as P,_ as A,H as b,J as M,x as W}from"./preact.module-rHvS-6NF.js";import{x as j,d as w,y as D}from"./hooks.module-CAf6ubPb.js";var E={};function c(t,e){for(var r in e)t[r]=e[r];return t}function S(t,e,r){var n,a=/(?:\?([^#]*))?(#.*)?$/,u=t.match(a),i={};if(u&&u[1])for(var p=u[1].split("&"),s=0;s<p.length;s++){var g=p[s].split("=");i[decodeURIComponent(g[0])]=decodeURIComponent(g.slice(1).join("="))}t=d(t.replace(a,"")),e=d(e||"");for(var K=Math.max(t.length,e.length),o=0;o<K;o++)if(e[o]&&e[o].charAt(0)===":"){var v=e[o].replace(/(^:|[+*?]+$)/g,""),h=(e[o].match(/[+*?]+$/)||E)[0]||"",y=~h.indexOf("+"),x=~h.indexOf("*"),k=t[o]||"";if(!k&&!x&&(h.indexOf("?")<0||y)){n=!1;break}if(i[v]=decodeURIComponent(k),y||x){i[v]=t.slice(o).map(decodeURIComponent).join("/");break}}else if(e[o]!==t[o]){n=!1;break}return(r.default===!0||n!==!1)&&i}function L(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function N(t,e){return t.index=e,t.rank=function(r){return r.props.default?0:d(r.props.path).map(T).join("")}(t),t.props}function d(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function T(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var _={},f=[],l=[],m={url:R()},$=P(m);function B(){var t=j($);if(t===m){var e=w()[1];D(function(){return l.push(e),function(){return l.splice(l.indexOf(e),1)}},[])}return[t,U]}function R(){var t;return""+((t=typeof location<"u"?location:_).pathname||"")+(t.search||"")}function U(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),function(r){for(var n=f.length;n--;)if(f[n].canRoute(r))return!0;return!1}(t)&&function(r,n){n===void 0&&(n="push"),typeof history<"u"&&history[n+"State"]&&history[n+"State"](null,null,r)}(t,e?"replace":"push"),I(t)}function I(t){for(var e=!1,r=0;r<f.length;r++)f[r].routeTo(t)&&(e=!0);return e}function H(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),r=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!r||r.match(/^_?self$/i)))return U(e)}}function J(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function O(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(H(e))return J(t)}while(e=e.parentNode)}}var C=!1;c(new W,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=b(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){C||(C=!0,addEventListener("popstate",function(){I(R())}),addEventListener("click",O)),f.push(this),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),f.splice(f.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(N).sort(L);for(var r=0;r<t.length;r++){var n=t[r],a=S(e,n.props.path,n.props);if(a)return[n,a]}},render:function(t,e){var r,n,a=t.onChange,u=e.url,i=this.c,p=this.g(b(t.children),u);if(p&&(n=M(p[0],c(c({url:u,matches:r=p[1]},r),{key:void 0,ref:void 0}))),u!==(i&&i.url)){c(m,i=this.c={url:u,previous:i&&i.url,current:n,path:n?n.props.path:null,matches:r}),i.router=this,i.active=n?[n]:[];for(var s=l.length;s--;)l[s]({});typeof a=="function"&&a(i)}return A($.Provider,{value:i},n)}});var F=function(t){return A("a",c({onClick:O},t))};export{B as C,F as E,S as s};
